# Active Time for Google Analytics

## Intro ##
This is a GTM template to track engagement time of users on websites. <br>
By importing the .tpl file as a template in GTM and setting up a tag afterwards, you can measure a much more reliable engagement time. The template will load a JavaScript file hosted on jsdelivr which will do the job of calculating, tracking and pushing the data to the dataLayer before the Page unloads.
## How does it work?
<li>Time will be measured between different input events like “onpointermove”, “onpointerdown”, “onlick” etc.
<li>Time will be tracked for multiple viewport parts at the same time. E.g. if you can see 20% of the website within your viewport, the measured time will be attributed toall current visible parts. This results in a division of the website into 100 parts where every part gets time attributed to if it was visible in the viewport.
<li>If the interval between the previous event and the current event is bigger than the specified idle timer, the time wont be added / tracked. Idle timer can be set in the tag itself.
<li>To avoid event spamming, a throttle function limits the execution of eventListeners by 500ms. 
Before a page unloads the data is compressed and pushed into the dataLayer<br><br>
Example of a dataLayer push executed by the script:
  
```javascript  
dataLayer.push({
  event: "engagementTime",
  timeOnSite: 14047,
  activeTime: 14045,
  idleTime: 2,
  smallScrollArr: [5683, 2730, 1574, 1883, 3105, null],
  scrollArr: [
    2116,
    2936,
    2936,
    2936,
    3176,
    6496,
    6496,
    6496,
    6496,
    6496,
    6496,
    6496,
    6496,
    6496,
    6496,
    6496,
    7025,
    7025,
    7025,
    7025,
    7025,
    7025,
    4909,
    4089,
    4089,
    4089,
    4367,
    1274,
    1566,
    1566,
    1566,
    1566,
    1566,
    1566,
    1566,
    1566,
    1566,
    1566,
    1037,
    1037,
    1037,
    1037,
    1037,
    1037,
    1551,
    1551,
    2170,
    2170,
    1652,
    1425,
    1133,
    1133,
    1133,
    1822,
    1822,
    1822,
    1822,
    1822,
    1822,
    2480,
    2480,
    2480,
    2480,
    2480,
    2480,
    2480,
    1966,
    1966,
    1511,
    1869,
    1869,
    1869,
    1869,
    1869,
    1869,
    1180,
    1180,
    1180,
    1180,
    1411,
    2279,
    1621,
    3503,
    3503,
    3503,
    3503,
    3503,
    3503,
    3503,
    3503,
    3339,
    2981,
    2981,
    2981,
    2981,
    2981,
    2981,
    2981,
    2981,
    2981,
    null,
    null,
    null,
    null
  ],
  medianArr: [6496, 1566, 1602, 1869, 2981, null],
  gtm.uniqueEventId: 391
})
```
