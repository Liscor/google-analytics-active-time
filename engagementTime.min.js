var debugMode=!0,currentClientHeight,idleState=!0,scrollArr=new Array(100).fill(null),modArr=new Array(5).fill(null),medianArr=new Array(5).fill(null),chunkSize=20,timer=5e3,activeTime=0,startTime=Date.now();debugMode&&console.log("startTime set: "+startTime);var prevTime=0,tempTime,maxScrollHeight=document.documentElement.scrollHeight,viewportHeight=Math.round(document.documentElement.clientHeight/maxScrollHeight*100);function createContentArr(){currentClientHeight=this.window.scrollY;var currentScrollDepth=Math.round(currentClientHeight/maxScrollHeight*100);activeTime+=tempTime-prevTime,debugMode&&console.log("activeTime: "+activeTime+" - tempTime - "+tempTime+" - prevTime - "+prevTime);for(var index=0;index<viewportHeight;index++)scrollArr[currentScrollDepth+index]+=tempTime-prevTime}function idleCheck(){var time=resetTimer;function resetTimer(){1==idleState&&(prevTime=Date.now()-startTime,idleState=!1),tempTime=Date.now()-startTime,createContentArr(),debugMode&&console.log("interval: "+(tempTime-prevTime)),prevTime=tempTime,clearTimeout(time),time=setTimeout(ifTimeOut,timer)}function ifTimeOut(){console.log("Time Out"),idleState=!0}window.onpointermove=throttle(resetTimer,500),window.onpointerdown=throttle(resetTimer,500),window.onclick=throttle(resetTimer,500),window.onkeydown=throttle(resetTimer,500),document.ontouchstart=throttle(resetTimer,500),window.addEventListener("scroll",throttle(resetTimer,500),!0)}function throttle(func,limit){var waiting;return function(){var args=arguments,context=this;waiting||(func.apply(context,args),waiting=!0,setTimeout((function delay(){waiting=!1}),limit))}}function calcMedian(tempArray){tempArray.sort((function(a,b){return a-b}));var middle=Math.floor(tempArray.length/2);return tempArray.length%2?tempArray[middle]:(tempArray[middle-1]+tempArray[middle])/2}function reduceScrollArr(){for(var tempArray,chunk=chunkSize,i=0,j=scrollArr.length,k=0;i<j;i+=chunk,k++)tempArray=scrollArr.slice(i,i+chunk).reduce((function(previousValue,currentValue){return previousValue+currentValue})),modArr[k]=Math.round(tempArray/chunkSize),medianArr[k]=Math.round(calcMedian(scrollArr.slice(i,i+chunk)));return modArr}idleCheck(),window.addEventListener("beforeunload",(function(event){var smallScrollArr=reduceScrollArr(),timeOnSite=Date.now()-startTime,engagementShare=Math.round(100/avgReadingTime*activeTime*100)/100;window.dataLayer.push({event:"engagementTime",timeOnSite:timeOnSite,activeTime:activeTime,idleTime:timeOnSite-activeTime,smallScrollArr:smallScrollArr,scrollArr:scrollArr,medianArr:medianArr})}));